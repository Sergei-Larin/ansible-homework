---
- name: Create users
  hosts: all
  become: yes
  gather_facts: no
  vars:
    users:
      - name: alice
        email: alice@example.com
        home_folder: /home/alice
        password: !vault |
                  $ANSIBLE_VAULT;1.1;AES256
                  65373439663332356334616335353631393061383862636164613365646239353239386239656239
                  6637353562346164326630613638313464303935643732320a373831636532646564363633333633
                  65613766636338326531383365393833306632363738386432353131353336623035376233306361
                  6336333439653231610a383734343466613561366233373661326334326131323939313261626663
                  6530
      - name: bob
        email: bob@example.com
        home_folder: /home/bob
        password: !vault |
                  $ANSIBLE_VAULT;1.1;AES256
                  36393439623131613661386335613736626539333863633462363739346333313766363839316664
                  3538343464613463373864636131393264666531386637350a623266636138633035613533613339
                  31313763653037353431643864326634616134353338313965383139393262363730616631323335
                  3534303765376132620a336633323062323237363334626234633862656332653437373261343039
                  3739
      - name: carol
        email: carol@example.com
        home_folder: /home/carol
        password: !vault |
                  $ANSIBLE_VAULT;1.1;AES256
                  66343161346666343233303432383333656537353336663738353334383062613733393831313630
                  6265386662626439646261393436636564633365346161320a356432306336333731356233653939
                  32396337656266666539633638333534633335636639343462613264306533396565356438396461
                  3162326363353136330a356531383132623635613130326365643261313766623933303433383765
                  3761
  tasks:
    - name: add user 
      user:
        name: "{{ item.name }}"
        comment: "{{ item.email }}"
        password: "{{ item.password | password_hash('sha512') }}"
        state: present
        create_home: yes
        home: "{{ item.home_folder }}"
        update_password: on_create
      loop: "{{ users }}"
      loop_control:
        label: "{{ item.name }}"
     
